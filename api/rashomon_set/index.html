
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://katarzynarogalska.github.io/ARSA-Automated-Rashomon-Set-Analysis/api/rashomon_set/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Rashomon set - ARSA Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rashomonset" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ARSA Documentation" class="md-header__button md-logo" aria-label="ARSA Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ARSA Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Rashomon set
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ARSA Documentation" class="md-nav__button md-logo" aria-label="ARSA Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ARSA Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home page
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<p><a href="../">back</a></p>
<h1 id="rashomonset">RashomonSet</h1>
<div style="background-color: #7ea1ee7a; padding: 10px; border-radius: 4px;">
class rashomon_analysis.<strong>RashomonSet</strong>(leaderboard, predictions, proba_predictions, feature_importances, base_metric, epsilon)
</div>
<p></br>
This class is the core class of the package. It creates the Rashomon Set for a given epsilon value and selected evaluation metric. 
</br>
</br></p>
<div style="background-color: lightgray; padding: 3px; border-radius: 0px;">
<strong>Parameters</strong>
</div>
<p></br>
    <strong>leaderboard</strong> : pd.DataFrame </br>
     &emsp;  Leaderboard in a DataFrame format consisting of models and their evaluation metrics scores. (Returned by converters)
    </br>
    <strong>predictions</strong> : dict </br>
    &emsp;  Dictionary with model names as keys and class prediction vectors as values. (Returned by convertees)
    </br>
    <strong>proba_predictions</strong> : dict </br>
    &emsp; Dictionary with model names as keys and class probabilities prediction DataFrames as values. (Returned by converters)
    </br>
    <strong>base_metric</strong> : str </br>
    &emsp; Evaluation metric to be used as a primary value for sorting model performances. Allowed metrics are specified in the METRICS attribute. 
    </br>
    <strong>epsilon</strong> : float </br>
    &emsp; Epsilon parameter specifying the allowable deviation from the best evaluation metric, within which a model qualifies for inclusion in the Rashomon Set.
</br>
</br> </p>
<div style="background-color: lightgray; padding: 3px; border-radius: 0px;">
<strong>Note</strong>
</div>
<p><br>
Allowed values of the <code>base_metric</code> parameter are: <br>
<strong>Binary classification: </strong>
'accuracy', 'balanced_accuracy',  'roc_auc', 'average_precision', 'precision', 'precision_macro', 'precision_micro','precision_weighted', 'recall', 'recall_macro', 'recall_micro', 'recall_weighted', 'f1', 'f1_macro', 'f1_micro', 'f1_weighted'  <br>
<strong> Multiclass classification: </strong> 'accuracy', 'balanced_accuracy', 'precision_macro', 'precision_micro', 'precision_weighted','recall_macro', 'recall_micro', 'recall_weighted', 'f1_macro', 'f1_micro', 'f1_weighted', 'roc_auc_ovo', 'roc_auc_ovo_weighted','roc_auc_ovr', 'roc_auc_ovr_micro', 'roc_auc_ovr_weighted'<br>
<br>
The <code>epsilon</code> parameter value should be greater than 0, as it represents the absolute difference threshold.
<br>
<br></p>
<div style="background-color: lightgray; padding: 3px; border-radius: 0px;">
<strong>Attributes</strong>
</div>
<p></br>
<strong>base_model</strong> : str </br>
    &emsp; Name of the model that achieved the highest score for the evaluation metric specified by base_metric parameter.
    </br>
    <strong>best_score</strong> : float </br>
    &emsp; The best value of the base_metric achieved by all models.
    </br>
    <strong>worst_score</strong> : dict </br>
    &emsp; The worst value of the base_metric achieved by all models.
    </br>
    <strong>rashomon_set</strong> : list </br>
    &emsp; Names of the models that are included in the Rashomon Set for given parameters. Obtained from get_rashomon_set() method. If the size of the set happens to contain less than 2 models, the constructor throws ValueError and asks to specify different parameters such as base_metric and epsilon.
    </br>
    <strong>rashomon_predictions</strong> : dict </br>
    &emsp; A subset of predictions dict parameter containing only models that are included in the Rashomon Set.
    </br>
    <strong>rashomon_proba_predictions</strong> : dict </br>
    &emsp; A subset of proba_predictions dict parameter containing only models that are included in the Rashomon Set.
    </br>
    <strong>number_of_classes</strong> : int </br>
    &emsp; Determining number of classes in the task based on the predictions vector. Obtained from determine_number_of_classes() method.
    </br>
    <strong>task_type</strong> : str </br>
    &emsp; Classification task type - 'binary' or 'multiclass' obtained from determine_task_type() method. 
    </br>
    <strong>METRICS</strong> : list </br>
    &emsp; All evaluation metrics that are allowed for analysis. 
    </br>
    <strong>METRICS_GREATER_IS_BETTER</strong> : dict </br>
    &emsp; A dictionary containing classification evaluation metrics names and the boolean value indicating whether this metric is interpreted as 'greater is better' (e.g accuracy) or not (e.g log loss).
    </br>
    <strong>leaderboard</strong> : pd.DataFrame </br>
     &emsp; leaderboard parameter value
    </br>
    <strong>predictions</strong> : dict </br>
    &emsp;  predictions parameter value
    </br>
    <strong>proba_predictions</strong> : dict </br>
    &emsp; proba_predictions parameter value
    </br>
    <strong>base_metric</strong> : str </br>
    &emsp; base_metric parameter value
    </br>
    <strong>epsilon</strong> : float </br>
    &emsp; epsilon parameter value 
</br>
</br></p>
<div style="background-color: lightgray; padding: 3px; border-radius: 0px;">
<strong>Methods</strong>
</div>
<p></br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>determine_task_type()</strong>
</div>
<p>&emsp; Returns whether the task type for a given dataset is binary or multiclass classification based on prediction vectors. If another task type is determined, the method throws ValueError. 
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>task_type</code> : str
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>determine_number_of_classes()</strong>
</div>
<p>&emsp; Method for determining number of classes in the task based on predictions vector.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>number_of_classes</code> : int
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>determine_number_of_samples()</strong>
</div>
<p>&emsp; Method for determining number of samples in the task based on predictions vector.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>number_of_samples</code> : int
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>find_base_model()</strong>
</div>
<p>&emsp; Returns the name of the model which achieved the best score for the evaluation metric specified by base_metric parameter. Uses the METRICS_GREATER_IS_BETTER to include the differences in metrics evaluation.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>base_model</code> : str
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>find_worst_model()</strong>
</div>
<p>&emsp; Returns the name of the model which achieved the worst score for the evaluation metric specified by base_metric parameter. Uses the METRICS_GREATER_IS_BETTER to include the differences in metrics evaluation.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp;<code> worst_model</code> : str
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>find_same_score_as_base()</strong>
</div>
<p>&emsp; Returns the number and names of models which achieved the same score for the evaluation metric specified by base_metric parameter as the base_model. Used especially when there are multiple models with the same scores.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>same_scores_count</code> : int
</br>
&emsp; <code>same_scores_models</code> : list
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>get_rashomon_set(<code>epsilon</code>)</strong>
</div>
<p>&emsp; Returns the names of models that are included in the Rashomon Set for a specified epsilon and base_metric. Rashomon set is defined as: </br></p>
<p>$$ 
S_\epsilon(h_0) := \lbrace h \in H : R(h_0) \le R(h) + \epsilon \rbrace
$$
where <span class="arithmatex">\(h_0\)</span> is the base_model, H is a set of all models in a hypothesis space and R is a selected risk function (base_metric). </br>
Read more about the Rashomon Set : <a href="https://proceedings.mlr.press/v119/marx20a/marx20a.pdf">Predictive Multiplicity in Classification (Definition 1)</a>
</br>
</br>
&emsp; <strong>Parameters :</strong> </br>
&emsp; <code>epsilon</code>: float, default = None
</br>
&emsp;&emsp;<em> When a different epsilon value is not specified the method uses the epsilon parameter value.</em>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>rashomon_set</code> : list
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>get_rashomon_predictions()</strong>
</div>
<p>&emsp; Returns the subsets of predictions and proba_predictions dictionaries containing only models that are included in the Rashomon Set.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>rashomon_predictions</code> : dict
</br>
&emsp;  <code>rashomon_proba_predictions</code> : dict
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>get_rashomon_feature_importances()</strong>
</div>
<p>&emsp; Returns the subsets of the feature_importance_dict containing only models that are included in the Rashomon Set.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>rashomon_feature_importances</code> : dict
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>binary_ambiguity()</strong>
</div>
<p>&emsp; Calculates binary ambiguity of a rashomon set by counting all observations where at least one model made a different class prediction than the base model. Those observations are considered ambiguous. Returns the fraction of ambiguous observations. Ambiguity is defined as:</br></p>
<p>$$ 
\displaystyle
{ \alpha(h_0) := \frac{1}{n}\sum_{i=1}^n max_{h \in S_{\epsilon}} \mathbf{1}[h(x_i) \neq h_0(x_i)]}
$$
where <span class="arithmatex">\(S_\epsilon\)</span> is the Rashomon Set and <span class="arithmatex">\(h(x_i)\)</span> is the models predction for observation <span class="arithmatex">\(x_i\)</span>.</br>
Read more about binary ambiguity : <a href="https://proceedings.mlr.press/v119/marx20a/marx20a.pdf">Predictive Multiplicity in Classification (Definition 3)</a>
</br>
</br>
Note : Method available only for binary classification task type.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>binary_ambiguity</code> : float
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>multiclass_ambiguity()</strong>
</div>
<p>&emsp; Calculates multiclass ambiguity of the Rashomon Set by counting all observations where at least one model made a different class prediction than the base model. Those observations are considered ambiguous. Returns the fraction of ambiguous observations. Multiclass ambiguity is defined as:</br></p>
<p>$$ 
\displaystyle
{ \alpha(h_0) := \frac{1}{n}\sum_{i=1}^n max_{h \in S_{\epsilon}} \mathbf{1}[argmax(h(x_i)) \neq argmax(h_0(x_i))]}
$$
where <span class="arithmatex">\(S_\epsilon\)</span> is the Rashomon Set and <span class="arithmatex">\(h(x_i)\)</span> is the class probabilities prediction vector for observation <span class="arithmatex">\(x_i\)</span>, then the <span class="arithmatex">\(argmax(h(x_i))\)</span> is the predicted class. </br>
Read more about muliclass ambiguity : <a href="https://arxiv.org/pdf/2206.01295">Rashomon Capacity: A Metric for
Predictive Multiplicity in Classification (Equation 2)</a>
<br>
<br>
Note: Method available only for multiclass classification task type.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>multiclass_ambiguity</code> : float
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>probabilistic_ambiguity(<code>delta</code>)</strong>
</div>
<p>&emsp; Calculates probabilistic ambiguity of the Rashomon Set by counting all observations where at least one model made a different risk prediction than the base model. Risk predictions need to have a difference greater than delta to be considered conflicting. Returns the fraction of ambiguous observations. The definition of probabilistic ambiguity is as follows:</br></p>
<p>$$ 
\displaystyle
{ \alpha(h_0, \delta) := \frac{1}{n}\sum_{i=1}^n \mathbf{1}[max_{h \in S_{\epsilon}} |g(x_i) - g_0(x_i)| \ge \delta ]}
$$
where <span class="arithmatex">\(S_\epsilon\)</span> is the Rashomon Set and <span class="arithmatex">\(g(x_i)\)</span> is the risk probability prediction <span class="arithmatex">\(P(y_i=1|x_i)\)</span> for observation <span class="arithmatex">\(x_i\)</span>. </br>
Read more about probabilistic ambiguity : <a href="https://arxiv.org/pdf/2206.01131">Predictive Multiplicity in Probabilistic Classification (Definition 3)</a>
<br>
<br>
Note : Method available only for binary classification task type.
</br>
</br>
    &emsp; <strong>Parameters :</strong> </br>
    &emsp;<code>delta</code> : float
</br>
&emsp;&emsp;<em>delta parameter indicates the minimum difference between two risk probabilities for the predictions to be considered conflicting.</em>
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>probabilistic_ambiguity</code> : float
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>binary_discrepancy()</strong>
</div>
<p>&emsp; Calculates discrepancy for binary classification task by counting how many predictions differ between base and reference model. Then choses the max sum of different predictions across all models from the Rashomon Set. Discrepancy is defined as:</p>
<p>$$ 
\displaystyle
{ \delta(h_0) := max_{h \in S_{\epsilon}} \frac{1}{n}\sum_{i=1}^n  \mathbf{1}[h(x_i) \neq h_0(x_i)]}
$$
where <span class="arithmatex">\(S_\epsilon\)</span> is the Rashomon Set and <span class="arithmatex">\(h(x_i)\)</span> is the models predction for observation <span class="arithmatex">\(x_i\)</span>.</br>
Read more about binary discrepancy : <a href="https://proceedings.mlr.press/v119/marx20a/marx20a.pdf">Predictive Multiplicity in Classification (Definition 4)</a>
</br>
</br>
Note: Method available only for binary classification task type.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>binary_discrepancy</code> : float
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>multiclass_discrepancy()</strong>
</div>
<p>&emsp; Calculates discrepancy for multiclass classification tasks by counting how many predictions differ between base and reference model. Then chooses the max sum of different predictions across all models from the Rashomon Set. Multiclass disrepancy is defined as:<br></p>
<p>$$ 
\displaystyle
{ \delta(h_0) := max_{h \in S_{\epsilon}} \frac{1}{n}\sum_{i=1}^n  \mathbf{1}[argmax(h(x_i)) \neq argmax(h_0(x_i))]}
$$
where <span class="arithmatex">\(S_\epsilon\)</span> is the Rashomon Set and <span class="arithmatex">\(h(x_i)\)</span> is the class probabilities prediction vector for observation <span class="arithmatex">\(x_i\)</span>, then the <span class="arithmatex">\(argmax(h(x_i))\)</span> is the predicted class. </br>
Read more about muliclass discrepancy : <a href="https://arxiv.org/pdf/2206.01295">Rashomon Capacity: A Metric for
Predictive Multiplicity in Classification (Equation 2)</a>
<br>
<br>
Note : Method available only for multiclass classification task type.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>multiclass_discrepancy</code> : float
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>probabilistic_discrepancy(<code>delta</code>)</strong>
</div>
<p>&emsp; Calculates discrepancy for binary target task by counting how many risk predictions differ between base and reference model. For predictions to be considered conflicting their difference must be greater than delta. Then choses the max sum of different predictions across all models from the Rashomon Set. Probabilistic discrepancy is defined as follows:</br></p>
<p>$$ 
\displaystyle
{ \delta_\epsilon(h_0, \delta) := max_{h \in S_{\epsilon}}\frac{1}{n}\sum_{i=1}^n \mathbf{1}[ |g(x_i) - g_0(x_i)| \ge \delta ]}
$$
where <span class="arithmatex">\(S_\epsilon\)</span> is the Rashomon Set and <span class="arithmatex">\(g(x_i)\)</span> is the risk probability prediction <span class="arithmatex">\(P(y_i=1|x_i)\)</span> for observation <span class="arithmatex">\(x_i\)</span>. </br>
Read more about probabilistic discrepancy : <a href="https://arxiv.org/pdf/2206.01131">Predictive Multiplicity in Probabilistic Classification (Definition 4)</a>
<br>
<br>
Note : Method available only for binary classification task type.
</br>
</br>
    &emsp; <strong>Parameters :</strong> </br>
    &emsp; <code>delta</code> : float
    </br>
&emsp;&emsp;<em>delta parameter indicates the minimum difference between two risk probabilities for the predictions to be considered conflicting.</em>
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>probabilistic_discrepancy</code> : float
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>viable_prediction_range()</strong>
</div>
<p>&emsp; Calculates the viable prediction range for each observation in the test dataset as the min and max risk probability predicted across all models in the Rashomon Set. Wide prediction range suggests high uncertainty about the observations prediction. VPR for the given observation is defined as: </br></p>
<p>$$
\displaystyle
{ V_\epsilon(x_i) := [min_{g \in S_\epsilon} g(x_i), max_{g \in S_\epsilon} g(x_i)] }
$$
where <span class="arithmatex">\(S_\epsilon\)</span> is the Rashomon Set and <span class="arithmatex">\(g(x_i)\)</span> is the risk probability prediction <span class="arithmatex">\(P(y_i=1|x_i)\)</span> for observation <span class="arithmatex">\(x_i\)</span>. </br>
Read more about Viable Prediction Range : <a href="https://arxiv.org/pdf/2206.01131">Predictive Multiplicity in Probabilistic Classification (Definition 2)</a>
<br>
<br>
Note : Method available only for binary classification task type.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>vprs</code> : list[tuple[float, float]]
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>agreement_rate()</strong>
</div>
<p>&emsp; For each observation, calculates the percentage of models, which made the same class prediction as the base model. If all models from the Rashomon Set predicted the same class as the base model, the agreement rate for the observation equals 1. 
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>agreement_rates</code> : list[float]
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>percent_agreement()</strong>
</div>
<p>&emsp; Calculates the proportion of observations for which each model from the Rashomon Set predicted the same class as the base model. Returns a dictionary mapping model names to their corresponding agreement percentages with the base model. If a given model made the same predictions for all observations as the base model, its percent agreement equals 100%.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>percent_agreements</code> : dict[str, float]
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>rashomon_ratio()</strong>
</div>
<p>&emsp; Calculates Rashomon Ratio which is the ratio of the Rashomon Set size to the total number of models present in the leaderboard. 
</br></p>
<div class="arithmatex">\[
\displaystyle
\hat{R}(H, \epsilon) := \frac{\text{vol}(S_{\epsilon}(h_0))}{\text{vol}(H)}
\]</div>
<p>where <span class="arithmatex">\(\text{vol}(S_{\epsilon}(h_0))\)</span> denotes the "volume" of the Rashomon Set — in our empirical setting this corresponds to the number of models in the Rashomon Set. Similarly, <span class="arithmatex">\(\text{vol}(H)\)</span> represents volume of hypothesis space, in this case number of models generated by AutoML framework.</p>
<p>Read more about the Rashomon Ratio in: <a href="https://arxiv.org/pdf/1908.01755v2">A Study in Rashomon Curves and Volumes: A New Perspective on Generalization and Model Simplicity in Machine Learning (Definition 2)</a>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>rashomon_ratio</code> : float
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>get_patterns_rashomon_set()</strong>
</div>
<p>&emsp; Method to retrieve all unique prediction patterns from the Rashomon Set, representing the collection of predictions produced by each model in the set. Returns a set of patterns in the Rashomon Set.
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>patterns</code> : set
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>get_patterns_hypothesis_set()</strong>
</div>
<p>&emsp; Method to retrieve all unique prediction patterns from models present in the hypothesis space (leaderboard).
</br>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>patterns</code> : set
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>pattern_rashomon_ratio()</strong>
</div>
<p>&emsp; Method for calculating Pattern Rashomon Ratio, defined as ratio of the number of unique prediction patterns in the Rashomon Set to the total number of unique predictions patterns in the hypothesis space (leaderboard).
</br></p>
<div class="arithmatex">\[
\hat{R}_{\mathrm{pattern}}(H, \epsilon) := 
\frac{\lvert \lbrace h(X) : h \in S_\epsilon \rbrace \rvert}
     {\lvert \lbrace h(X) : h \in H \rbrace \rvert}
\]</div>
<p>where <span class="arithmatex">\(X\)</span> denotes the dataset all the models were trained on, and <span class="arithmatex">\(h(X)\)</span> denotes all predictions made by model <span class="arithmatex">\(h\)</span> across all samples in the dataset. </p>
<p><span class="arithmatex">\(H\)</span> is the hypothesis space (in this case all models present in the leaderboard), and <span class="arithmatex">\(S_\epsilon\)</span> is the Rashomon Set.</p>
<p>Read more about the Pattern Rashomon Ratio in: <a href="https://arxiv.org/pdf/1908.01755v2">A Study in Rashomon Curves and Volumes: A New Perspective on Generalization and Model Simplicity in Machine Learning (Definition 3)</a></p>
<p></br>
&emsp; <strong>Returns :</strong> </br>
&emsp; <code>pattern_rashomon_ratio</code>: float
</br>
<br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>rashomon_capacity( <code>sample_index</code> )</strong>
</div>
<p>&emsp; Method for calculating Rashomon Capacity for a given sample. The parameter <code>sample_index</code> should be an index of a sample the Rashomon Capacity is to be calculated. The output value is a float in the range [1, c], where c is the number of classes in the classification task. </br>
&emsp; If Rashomon Capacity equals 1, then all the models produced the same outputs for given sample, so there is no predictive multiplicity. <br>
&emsp; If Rashomon Capacity equals c, that indicates that the models produce maximally diverse predictions for the given sample, resulting in highest predictive multiplicity. 
<br>
&emsp; Read more about Rashomon Capacity: <a href="https://arxiv.org/pdf/2206.01295" target="_blank">Rashomon Capacity: A Metric for Predictive Multiplicity in Classification (Definition 2)</a>.
<br>
<br>
    &emsp; <strong>Parameters :</strong> </br>
    &emsp; <code>sample_index</code> : int
    <br>
    <br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>rashomon_capacity</code> : float
</br>
<br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>generate_transition_matrix( <code>sample_index</code> )</strong>
</div>
<p>&emsp; Method for generating transition matrix for a given sample. Transition matrix (m, c) is a matrix, where m corresponds to the number of models included in the set, while c denotes the number of classes associated with the prediction task. This matrix is used by the Blahut–Arimoto algorithm to compute the channel capacity.
</br>
</br>
    &emsp; <strong>Parameters :</strong> </br>
    &emsp; <code>sample_index</code> : int
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>transition_matrix</code> : np.ndarray
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>blahut_arimoto_algorithm( <code>transition_matrix</code>,  <code>max_iterations</code>, <code>tolerance</code>)</strong>
</div>
<p>&emsp; Method for computing the <em>channel capacity</em> for a given sample. 
Channel capacity is defined as the maximum mutual information between the channel input <i>X</i> (here representing the models in the Rashomon set) and the channel output <i>Y</i> (the corresponding probabilistic predictions), maximized over all possible input distributions <i>p(x)</i>. <br>
&emsp; Intuitively, this algorithm finds the probability distribution over models (inputs) that maximizes how informative their predictions (outputs) are.
<br>
&emsp; For more details and inspiration, see the <a href="https://github.com/HsiangHsu/rashomon-capacity" target="_blank">Rashomon Capacity GitHub repository</a>.
</br>
<br>
&emsp; <strong>Parameters :</strong>
&emsp;<ul>
    <li><code>transition_matrix</code> : np.array, matrix with m rows (models from the Rashomon Set) and c columns (number of classes for specified task). The columns of the transition matrix represent the class probability distributions predicted by each model for every class for specific sample.</li>
    <li><code>max_iterations</code> : int, maximum number of algorithm iterations, default = 1000</li>
    <li><code>tolerance</code> : float, error tolerance for algorithm to stop iterations, default = 1e-8</li>
</ul>
&emsp; <strong>Returns :</strong> </br>
&emsp; <code>channel_capacity</code> : float
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>cohens_kappa()</strong>
</div>
<p>&emsp; Method for calculating Cohen's Kappa metric for every model in the Rashomon Set relative to the base model.
Cohen's Kappa measures agreement between two models predictions adjusted for agreement expected to occur by chance. 
<br>
Values range from -1 to 1, where 1 indicates perfect agreement in models predictions, 0 means agreement that would be expected by chance and -1 denotes no agreement where models make opposite predictions.</p>
<p>The formula for calculating Cohen's Kappa is defined as follows:
$$
\displaystyle
\kappa = \frac{p_o - p_e}{1 - p_e}
$$
where <span class="arithmatex">\(p_o\)</span> denotes observed agreement between two models (proportion of matching predictions generated by both models, see percent agreement metric) and <span class="arithmatex">\(p_e\)</span> is the expected agreement by chance, calculated from the marginal proportions of predictions for each class by the models.
<br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>cohens_kappa_dict</code> : dict
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>cohens_kappa_matrix()</strong>
</div>
<p>&emsp; Method for calculating the Cohen's Kappa metric for every pair of models in the Rashomon Set. It returns a symmetric matrix where the entry at [i, j] represents the Cohen's Kappa score between model i and model j. 
Diagonal entries are 1.0, representing a model compared with itself.
<br>
<br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>kappa_matrix</code> : pd.DataFrame
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>get_rashomon_metrics( <code>delta</code> )</strong>
</div>
<p>&emsp; Method for returning all Rashomon Set related metrics and attributes in a dictionary format. The retuned properties are: base model, rashomon set size, task type, number of classes, rashomon ratio, pattern rashomon ratio, ambiguity, discrepancy, probabilistic ambiguity, probabilistic discrepancy, VPRs, agreement rates, percent agreements, mean rashomon capacity, min rashomon capacity, max rashomon capacity, std rashomon capacity. 
</br>
</br>
    &emsp; <strong>Parameters :</strong> </br>
    &emsp; <code>delta</code> : float, default = 0.1 <br>
    &emsp; &emsp; <em>delta parameter used in probabilitisc_ambiguity() and probabilitic_discrepancy() methods for binary task type</em>
</br>
    &emsp; <strong>Returns :</strong> </br>
    &emsp; <code>metrics</code> : dict
</br>
</br></p>
<div style="color: #3F51B5; font-size: 0.9rem;">
    <strong>summarize_rashomon( <code>delta</code> )</strong>
</div>
<p>&emsp; Method for printing key Rashomon Set related metrics and attributes on the console. The printed properties are: base metric, base model, models with the same score as base, best and worst score across all rashomon set models, rashomon set size, task type, number of classes, rashomon ratio, pattern rashomon ratio, ambiguity, discrepancy, probabilistic ambiguity, probabilistic discrepancy, min agreement rate, max agreement rate, std agreement rage, percent agreements, mean rashomon capacity, min rashomon capacity, max rashomon capacity, std rashomon capacity. 
</br>
</br>
    &emsp; <strong>Parameters :</strong> </br>
    &emsp; <code>delta</code> : float, default = 0.1 <br>
    &emsp; &emsp; <em>delta parameter used in probabilitisc_ambiguity() and probabilitic_discrepancy() methods for binary task type</em>
</br>
</br></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>